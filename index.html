<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SiliconAtlas Repository</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî¨</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

<style>
  :root {
    --bg: #0b0e14;
    --surface: #131720;
    --card: #181d28;
    --card-hover: #1e2433;
    --accent: #00d4aa;
    --accent-dim: #00a382;
    --accent-glow: rgba(0, 212, 170, 0.12);
    --accent-glow2: rgba(0, 212, 170, 0.06);
    --blue: #4a9eff;
    --blue-dim: #2a6ec0;
    --orange: #ff8c42;
    --red: #ff4757;
    --red-dim: #c0392b;
    --text: #e2e8f0;
    --text-dim: #64748b;
    --text-muted: #475569;
    --border: #1e293b;
    --border-light: #2a3548;
    --input-bg: #0f1219;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Outfit', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚ïê‚ïê‚ïê GRID BACKGROUND ‚ïê‚ïê‚ïê */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image:
      linear-gradient(rgba(0,212,170,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,170,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    z-index: 0;
  }

  /* ‚ïê‚ïê‚ïê LOGIN SCREEN ‚ïê‚ïê‚ïê */
  .login-screen {
    position: fixed;
    inset: 0;
    z-index: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--bg);
    padding: 20px;
  }

  .login-screen.hidden {
    display: none;
  }

  .login-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 40px 36px;
    width: 100%;
    max-width: 400px;
    animation: modalIn 0.3s ease;
  }

  .login-logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 8px;
  }

  .login-logo .logo-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 24px rgba(0,212,170,0.2);
  }

  .login-logo h1 {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 26px;
    font-weight: 600;
    background: linear-gradient(135deg, var(--accent) 0%, var(--blue) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .login-subtitle {
    text-align: center;
    font-size: 13px;
    color: var(--text-dim);
    margin-bottom: 32px;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .login-card .form-group { margin-bottom: 18px; }

  .login-card .form-group label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    margin-bottom: 8px;
  }

  .login-card .form-group input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--input-bg);
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .login-card .form-group input:focus { border-color: var(--accent); }
  .login-card .form-group input::placeholder { color: var(--text-muted); }

  .login-btn {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    font-family: 'Outfit', sans-serif;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    background: linear-gradient(135deg, var(--accent), var(--accent-dim));
    color: #000;
    box-shadow: 0 4px 16px rgba(0,212,170,0.2);
    transition: all 0.2s;
    margin-top: 8px;
  }

  .login-btn:hover { box-shadow: 0 4px 24px rgba(0,212,170,0.35); transform: translateY(-1px); }
  .login-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .login-error {
    margin-top: 14px;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 13px;
    background: rgba(255,71,87,0.1);
    color: var(--red);
    border: 1px solid rgba(255,71,87,0.2);
    display: none;
    text-align: center;
  }

  .login-error.visible { display: block; }

  /* ‚ïê‚ïê‚ïê APP (hidden until auth) ‚ïê‚ïê‚ïê */
  .app {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: none; /* hidden until authenticated */
  }

  .app.visible { display: block; }

  /* ‚ïê‚ïê‚ïê SIGN-OUT BUTTON ‚ïê‚ïê‚ïê */
  .signout-btn {
    position: fixed;
    top: 16px;
    right: 16px;
    z-index: 50;
    padding: 8px 14px;
    border-radius: 8px;
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text-dim);
    transition: all 0.2s;
    display: none;
  }

  .signout-btn.visible { display: inline-flex; align-items: center; gap: 6px; }
  .signout-btn:hover { border-color: var(--red); color: var(--red); background: rgba(255,71,87,0.06); }

  /* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
  .header {
    text-align: center;
    padding: 40px 0 32px;
    position: relative;
  }

  .header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 200px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
  }

  .logo-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    margin-bottom: 6px;
  }

  .logo-icon {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--accent), var(--blue));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    box-shadow: 0 0 24px rgba(0,212,170,0.2);
  }

  h1 {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 32px;
    font-weight: 600;
    letter-spacing: -0.5px;
    background: linear-gradient(135deg, var(--accent) 0%, var(--blue) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .tagline {
    font-size: 14px;
    color: var(--text-dim);
    margin-top: 6px;
    font-weight: 300;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .sync-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 16px;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    font-family: 'IBM Plex Mono', monospace;
  }

  .sync-badge.ok { background: rgba(0,212,170,0.1); color: var(--accent); border: 1px solid rgba(0,212,170,0.2); }
  .sync-badge.off { background: rgba(255,71,87,0.1); color: var(--red); border: 1px solid rgba(255,71,87,0.2); }
  .sync-dot { width: 7px; height: 7px; border-radius: 50%; }
  .sync-badge.ok .sync-dot { background: var(--accent); animation: pulse 2s infinite; }
  .sync-badge.off .sync-dot { background: var(--red); }

  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* ‚ïê‚ïê‚ïê STATS BAR ‚ïê‚ïê‚ïê */
  .stats-bar {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin: 28px 0;
    padding: 16px 24px;
    background: var(--surface);
    border-radius: 12px;
    border: 1px solid var(--border);
  }

  .stat { text-align: center; }
  .stat-val {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 24px;
    font-weight: 600;
    color: var(--accent);
  }
  .stat-label { font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 2px; }

  /* ‚ïê‚ïê‚ïê TOOLBAR ‚ïê‚ïê‚ïê */
  .toolbar {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-wrap: wrap;
  }

  .search-box {
    flex: 1;
    min-width: 220px;
    position: relative;
  }

  .search-box input {
    width: 100%;
    padding: 12px 16px 12px 42px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--input-bg);
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-box input:focus { border-color: var(--accent); }
  .search-box input::placeholder { color: var(--text-muted); }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 16px;
    pointer-events: none;
  }

  .btn {
    padding: 12px 20px;
    border-radius: 10px;
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent-dim));
    color: #000;
    font-weight: 600;
    box-shadow: 0 4px 16px rgba(0,212,170,0.2);
  }
  .btn-primary:hover { box-shadow: 0 4px 24px rgba(0,212,170,0.35); transform: translateY(-1px); }

  .btn-secondary {
    background: var(--surface);
    color: var(--text);
    border: 1px solid var(--border);
  }
  .btn-secondary:hover { border-color: var(--border-light); background: var(--card); }

  .btn-danger {
    background: rgba(255,71,87,0.1);
    color: var(--red);
    border: 1px solid rgba(255,71,87,0.2);
  }
  .btn-danger:hover { background: rgba(255,71,87,0.2); }

  .btn-sm { padding: 8px 14px; font-size: 13px; }

  /* ‚ïê‚ïê‚ïê TABLE ‚ïê‚ïê‚ïê */
  .table-wrap {
    background: var(--surface);
    border-radius: 14px;
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .table-scroll { overflow-x: auto; }

  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 960px;
  }

  thead th {
    padding: 14px 16px;
    text-align: left;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-dim);
    background: var(--card);
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
    position: sticky;
    top: 0;
  }

  thead th:first-child { padding-left: 20px; }

  thead th.sortable {
    cursor: pointer;
    user-select: none;
    transition: color 0.15s;
  }
  thead th.sortable:hover { color: var(--accent); }
  thead th .sort-arrow {
    display: inline-block;
    margin-left: 4px;
    font-size: 10px;
    opacity: 0.3;
    transition: opacity 0.15s;
  }
  thead th.sorted .sort-arrow { opacity: 1; color: var(--accent); }

  .sample-date {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: var(--orange);
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
    cursor: pointer;
  }

  tbody tr:hover { background: var(--accent-glow2); }
  tbody tr:last-child { border-bottom: none; }

  td {
    padding: 14px 16px;
    font-size: 14px;
    vertical-align: middle;
  }

  td:first-child { padding-left: 20px; }

  .sample-name {
    font-weight: 600;
    color: var(--text);
  }

  .sample-id {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 13px;
    color: var(--accent);
    background: var(--accent-glow);
    padding: 3px 8px;
    border-radius: 6px;
    display: inline-block;
  }

  .sample-desc {
    color: var(--text-dim);
    font-size: 13px;
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .sample-owner {
    font-weight: 500;
    color: var(--blue);
  }

  .sample-thumb {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    object-fit: cover;
    border: 1px solid var(--border);
    background: var(--card);
    cursor: pointer;
  }

  .sample-thumb-placeholder {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    background: var(--card);
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: var(--text-muted);
  }

  .actions-cell { display: flex; gap: 6px; }

  .icon-btn {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-dim);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    transition: all 0.15s;
  }

  .icon-btn:hover { border-color: var(--border-light); color: var(--text); background: var(--card); }
  .icon-btn.delete:hover { border-color: rgba(255,71,87,0.3); color: var(--red); background: rgba(255,71,87,0.08); }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-dim);
  }

  .empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
  .empty-state p { font-size: 14px; }

  /* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    backdrop-filter: blur(4px);
    z-index: 100;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .modal-overlay.active { display: flex; }

  .modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    width: 100%;
    max-width: 520px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalIn 0.2s ease;
  }

  @keyframes modalIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
  }

  .modal-header h2 {
    font-size: 18px;
    font-weight: 600;
  }

  .modal-close {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text-dim);
    cursor: pointer;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
  }

  .modal-close:hover { color: var(--text); background: var(--card); }

  .modal-body { padding: 24px; }

  .form-group { margin-bottom: 20px; }

  .form-group label {
    display: block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-dim);
    margin-bottom: 8px;
  }

  .form-group input,
  .form-group textarea {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: var(--input-bg);
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .form-group input:focus,
  .form-group textarea:focus { border-color: var(--accent); }

  .form-group textarea { resize: vertical; min-height: 80px; }

  .form-group input::placeholder,
  .form-group textarea::placeholder { color: var(--text-muted); }

  /* Image upload area */
  .upload-area {
    border: 2px dashed var(--border);
    border-radius: 12px;
    padding: 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
  }

  .upload-area:hover { border-color: var(--accent); background: var(--accent-glow2); }
  .upload-area.has-image { padding: 0; border-style: solid; }

  .upload-area .upload-text { color: var(--text-dim); font-size: 14px; }
  .upload-area .upload-icon { font-size: 28px; margin-bottom: 8px; }
  .upload-area .upload-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

  .upload-preview {
    width: 100%;
    max-height: 200px;
    object-fit: contain;
    display: block;
    border-radius: 10px;
  }

  .upload-remove {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: rgba(0,0,0,0.7);
    border: none;
    color: #fff;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    padding: 16px 24px;
    border-top: 1px solid var(--border);
  }

  /* ‚ïê‚ïê‚ïê IMAGE VIEWER MODAL ‚ïê‚ïê‚ïê */
  .viewer-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(8px);
    z-index: 200;
    align-items: center;
    justify-content: center;
    padding: 40px;
    cursor: pointer;
  }

  .viewer-overlay.active { display: flex; }

  .viewer-overlay img {
    max-width: 90vw;
    max-height: 85vh;
    object-fit: contain;
    border-radius: 8px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }

  /* ‚ïê‚ïê‚ïê CONFIRM MODAL ‚ïê‚ïê‚ïê */
  .confirm-modal {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 24px;
    max-width: 380px;
    width: 90%;
    text-align: center;
  }

  .confirm-modal p { font-size: 15px; margin-bottom: 20px; line-height: 1.5; }
  .confirm-modal .confirm-name { color: var(--accent); font-weight: 600; }
  .confirm-btns { display: flex; gap: 10px; }
  .confirm-btns button { flex: 1; }

  /* ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê */
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 14px 20px;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 500;
    z-index: 300;
    animation: slideIn 0.3s ease;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    border: 1px solid;
    display: none;
  }

  .toast.show { display: block; }
  .toast.success { background: rgba(0,212,170,0.15); color: var(--accent); border-color: rgba(0,212,170,0.3); }
  .toast.error { background: rgba(255,71,87,0.15); color: var(--red); border-color: rgba(255,71,87,0.3); }

  @keyframes slideIn { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }

  /* ‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê */
  @media (max-width: 640px) {
    .app { padding: 12px; }
    h1 { font-size: 24px; }
    .logo-icon { width: 36px; height: 36px; font-size: 18px; }
    .stats-bar { gap: 20px; padding: 14px 16px; }
    .stat-val { font-size: 20px; }
    .toolbar { flex-direction: column; }
    .search-box { min-width: unset; }
    .table-wrap { border-radius: 10px; }
    .modal { margin: 10px; }
    .login-card { padding: 32px 24px; }
  }

  /* scrollbar */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  LOGIN SCREEN                              -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="login-screen" id="login-screen">
  <div class="login-card">
    <div class="login-logo">
      <div class="logo-icon">‚öõ</div>
      <h1>SiliconAtlas</h1>
    </div>
    <p class="login-subtitle">Sign in to access the repository</p>

    <div class="form-group">
      <label>Email</label>
      <input type="email" id="login-email" placeholder="lab@example.com" autocomplete="email">
    </div>
    <div class="form-group">
      <label>Password</label>
      <input type="password" id="login-password" placeholder="Enter password" autocomplete="current-password">
    </div>

    <button class="login-btn" id="login-btn" onclick="handleLogin()">Sign In</button>

    <div class="login-error" id="login-error"></div>
  </div>
</div>

<!-- Sign-out button (top-right, visible when logged in) -->
<button class="signout-btn" id="signout-btn" onclick="handleSignOut()">‚èª Sign Out</button>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!--  MAIN APP (hidden until authenticated)     -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="app" id="main-app">
  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Header -->
  <header class="header">
    <div class="logo-row">
      <div class="logo-icon">‚öõ</div>
      <h1>SiliconAtlas</h1>
    </div>
    <p class="tagline">Sample Repository</p>
    <div class="sync-badge ok" id="sync-badge">
      <span class="sync-dot"></span>
      <span id="sync-text">Connected</span>
    </div>
  </header>

  <!-- Stats -->
  <div class="stats-bar">
    <div class="stat">
      <div class="stat-val" id="total-count">0</div>
      <div class="stat-label">Samples</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="owner-count">0</div>
      <div class="stat-label">Owners</div>
    </div>
    <div class="stat">
      <div class="stat-val" id="image-count">0</div>
      <div class="stat-label">With Images</div>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar">
    <div class="search-box">
      <span class="search-icon">‚åï</span>
      <input type="text" id="search-input" placeholder="Search samples..." oninput="renderTable()">
    </div>
    <button class="btn btn-primary" onclick="openAddModal()">
      <span>+</span> Add Sample
    </button>
  </div>

  <!-- Table -->
  <div class="table-wrap">
    <div class="table-scroll">
      <table>
        <thead>
          <tr>
            <th>Image</th>
            <th class="sortable" onclick="sortBy('name')">Sample Name <span class="sort-arrow">‚ñ≤</span></th>
            <th class="sortable" onclick="sortBy('sampleId')">Sample ID <span class="sort-arrow">‚ñ≤</span></th>
            <th class="sortable" onclick="sortBy('description')">Description <span class="sort-arrow">‚ñ≤</span></th>
            <th class="sortable" onclick="sortBy('owner')">Current Owner <span class="sort-arrow">‚ñ≤</span></th>
            <th class="sortable" onclick="sortBy('date')">Date <span class="sort-arrow">‚ñ≤</span></th>
            <th class="sortable" onclick="sortBy('location')">Location <span class="sort-arrow">‚ñ≤</span></th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <tr>
            <td colspan="8">
              <div class="empty-state">
                <div class="empty-icon">üî¨</div>
                <p>Loading samples...</p>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Add/Edit Modal -->
<div class="modal-overlay" id="form-modal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modal-title">Add Sample</h2>
      <button class="modal-close" onclick="closeFormModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Sample Name *</label>
        <input type="text" id="f-name" placeholder="e.g. IGZO TFT on Si/SiO2">
      </div>
      <div class="form-group">
        <label>Sample ID *</label>
        <input type="text" id="f-id" placeholder="e.g. IGZO-2025-001">
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="f-desc" placeholder="Brief description of the sample, fabrication details, etc."></textarea>
      </div>
      <div class="form-group">
        <label>Current Owner *</label>
        <input type="text" id="f-owner" placeholder="e.g. Filippo">
      </div>
      <div class="form-group">
        <label>Date</label>
        <input type="date" id="f-date">
      </div>
      <div class="form-group">
        <label>Location</label>
        <input type="text" id="f-location" placeholder="e.g. ERC 151, ASU Tempe">
      </div>
      <div class="form-group">
        <label>Sample Image</label>
        <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
          <div id="upload-placeholder">
            <div class="upload-icon">üì∑</div>
            <div class="upload-text">Click to upload image</div>
            <div class="upload-hint">JPG, PNG, WebP ‚Äî max 5 MB</div>
          </div>
          <img class="upload-preview" id="upload-preview" style="display:none;">
          <button class="upload-remove" id="upload-remove" style="display:none;" onclick="removeImage(event)">‚úï</button>
        </div>
        <input type="file" id="file-input" accept="image/*" style="display:none;" onchange="handleFileSelect(event)">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeFormModal()">Cancel</button>
      <button class="btn btn-primary" id="save-btn" onclick="saveSample()">Save Sample</button>
    </div>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div class="modal-overlay" id="confirm-modal">
  <div class="confirm-modal">
    <p>Delete sample<br><span class="confirm-name" id="confirm-name"></span>?</p>
    <div class="confirm-btns">
      <button class="btn btn-secondary" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
    </div>
  </div>
</div>

<!-- Image Viewer -->
<div class="viewer-overlay" id="viewer" onclick="closeViewer()">
  <img id="viewer-img" src="">
</div>

<script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  üîß FIREBASE CONFIG
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const firebaseConfig = {
    apiKey: "AIzaSyDO_iRY_u5hjf47EzryGn-wxttU0csDZbA",
    authDomain: "silicon-atlas.firebaseapp.com",
    databaseURL: "https://silicon-atlas-default-rtdb.firebaseio.com",
    projectId: "silicon-atlas",
    storageBucket: "silicon-atlas.firebasestorage.app",
    messagingSenderId: "809080417813",
    appId: "1:809080417813:web:56071587614a0ba22ba81c",
    measurementId: "G-ZNL8H7ZPZX"
  };
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const samplesRef = db.ref('samples');

  let allSamples = {};
  let editingKey = null;
  let selectedFile = null;
  let deleteKey = null;
  let sortColumn = 'createdAt';
  let sortDir = 'desc';
  let dbListener = null; // track the realtime listener

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  üîê AUTH ‚Äî Login / Logout / State Observer
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  // Listen for auth state changes
  auth.onAuthStateChanged((user) => {
    if (user) {
      // User is signed in ‚Üí show app, hide login
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.add('visible');
      document.getElementById('signout-btn').classList.add('visible');
      startDatabaseListener();
    } else {
      // User is signed out ‚Üí show login, hide app
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('main-app').classList.remove('visible');
      document.getElementById('signout-btn').classList.remove('visible');
      stopDatabaseListener();
    }
  });

  // Handle login form
  async function handleLogin() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    const errorEl = document.getElementById('login-error');
    const btn = document.getElementById('login-btn');

    errorEl.classList.remove('visible');

    if (!email || !password) {
      errorEl.textContent = 'Please enter email and password';
      errorEl.classList.add('visible');
      return;
    }

    btn.disabled = true;
    btn.textContent = 'Signing in...';

    try {
      await auth.signInWithEmailAndPassword(email, password);
      // onAuthStateChanged will handle the UI switch
    } catch (err) {
      let msg = 'Sign-in failed';
      switch (err.code) {
        case 'auth/invalid-email': msg = 'Invalid email address'; break;
        case 'auth/user-not-found': msg = 'Account not found'; break;
        case 'auth/wrong-password': msg = 'Incorrect password'; break;
        case 'auth/invalid-credential': msg = 'Invalid email or password'; break;
        case 'auth/too-many-requests': msg = 'Too many attempts ‚Äî try again later'; break;
      }
      errorEl.textContent = msg;
      errorEl.classList.add('visible');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Sign In';
    }
  }

  // Handle sign-out
  async function handleSignOut() {
    try {
      await auth.signOut();
      showToast('Signed out', 'success');
    } catch (err) {
      console.error('Sign-out error:', err);
    }
  }

  // Allow Enter key to submit login form
  document.getElementById('login-password').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') handleLogin();
  });
  document.getElementById('login-email').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') document.getElementById('login-password').focus();
  });

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  üì° DATABASE ‚Äî start/stop listener on auth
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function startDatabaseListener() {
    if (dbListener) return; // already listening
    dbListener = samplesRef.on('value', (snapshot) => {
      allSamples = snapshot.val() || {};
      updateStats();
      renderTable();
      setSyncStatus(true);
    }, (err) => {
      console.error('DB error:', err);
      setSyncStatus(false);
    });
  }

  function stopDatabaseListener() {
    if (dbListener) {
      samplesRef.off('value', dbListener);
      dbListener = null;
    }
    allSamples = {};
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  //  EVERYTHING BELOW IS UNCHANGED FROM ORIGINAL
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  function setSyncStatus(ok) {
    const badge = document.getElementById('sync-badge');
    const text = document.getElementById('sync-text');
    badge.className = 'sync-badge ' + (ok ? 'ok' : 'off');
    text.textContent = ok ? 'Connected' : 'Disconnected';
  }

  function updateStats() {
    const entries = Object.values(allSamples);
    document.getElementById('total-count').textContent = entries.length;
    const owners = new Set(entries.map(s => s.owner?.toLowerCase()).filter(Boolean));
    document.getElementById('owner-count').textContent = owners.size;
    const withImg = entries.filter(s => s.imageUrl).length;
    document.getElementById('image-count').textContent = withImg;
  }

  // ‚îÄ‚îÄ‚îÄ Sort ‚îÄ‚îÄ‚îÄ
  function sortBy(col) {
    if (sortColumn === col) {
      sortDir = sortDir === 'asc' ? 'desc' : 'asc';
    } else {
      sortColumn = col;
      sortDir = 'asc';
    }
    renderTable();
  }

  function updateSortHeaders() {
    document.querySelectorAll('thead th.sortable').forEach(th => {
      const col = th.getAttribute('onclick').match(/sortBy\('(.+?)'\)/)?.[1];
      const arrow = th.querySelector('.sort-arrow');
      if (col === sortColumn) {
        th.classList.add('sorted');
        arrow.textContent = sortDir === 'asc' ? '‚ñ≤' : '‚ñº';
      } else {
        th.classList.remove('sorted');
        arrow.textContent = '‚ñ≤';
      }
    });
  }

  // ‚îÄ‚îÄ‚îÄ Render Table ‚îÄ‚îÄ‚îÄ
  function renderTable() {
    const query = document.getElementById('search-input').value.toLowerCase().trim();
    const tbody = document.getElementById('table-body');
    const entries = Object.entries(allSamples);

    const filtered = entries.filter(([key, s]) => {
      if (!query) return true;
      return (s.name || '').toLowerCase().includes(query) ||
             (s.sampleId || '').toLowerCase().includes(query) ||
             (s.description || '').toLowerCase().includes(query) ||
             (s.owner || '').toLowerCase().includes(query) ||
             (s.date || '').toLowerCase().includes(query) ||
             (s.location || '').toLowerCase().includes(query);
    });

    if (filtered.length === 0) {
      tbody.innerHTML = `<tr><td colspan="8">
        <div class="empty-state">
          <div class="empty-icon">${query ? 'üîç' : 'üî¨'}</div>
          <p>${query ? 'No samples matching your search' : 'No samples yet ‚Äî add the first one!'}</p>
        </div>
      </td></tr>`;
      updateSortHeaders();
      return;
    }

    filtered.sort((a, b) => {
      let valA, valB;
      if (sortColumn === 'createdAt') {
        valA = a[1].createdAt || 0;
        valB = b[1].createdAt || 0;
      } else if (sortColumn === 'date') {
        valA = a[1].date || '';
        valB = b[1].date || '';
      } else if (sortColumn === 'location') {
        valA = (a[1].location || '').toLowerCase();
        valB = (b[1].location || '').toLowerCase();
      } else {
        valA = (a[1][sortColumn] || '').toLowerCase();
        valB = (b[1][sortColumn] || '').toLowerCase();
      }
      if (valA < valB) return sortDir === 'asc' ? -1 : 1;
      if (valA > valB) return sortDir === 'asc' ? 1 : -1;
      return 0;
    });

    tbody.innerHTML = filtered.map(([key, s]) => {
      const imgCell = s.imageUrl
        ? `<img class="sample-thumb" src="${escHtml(s.imageUrl)}" alt="${escHtml(s.name)}" onclick="openViewer('${escHtml(s.imageUrl)}')" loading="lazy">`
        : `<div class="sample-thumb-placeholder">‚öõ</div>`;

      const dateStr = s.date || '‚Äî';

      return `<tr>
        <td>${imgCell}</td>
        <td><span class="sample-name">${escHtml(s.name || '‚Äî')}</span></td>
        <td><span class="sample-id">${escHtml(s.sampleId || '‚Äî')}</span></td>
        <td><span class="sample-desc" title="${escHtml(s.description || '')}">${escHtml(s.description || '‚Äî')}</span></td>
        <td><span class="sample-owner">${escHtml(s.owner || '‚Äî')}</span></td>
        <td><span class="sample-date">${escHtml(dateStr)}</span></td>
        <td><span class="sample-owner">${escHtml(s.location || '‚Äî')}</span></td>
        <td>
          <div class="actions-cell">
            <button class="icon-btn" title="Edit" onclick="openEditModal('${key}')">‚úé</button>
            <button class="icon-btn delete" title="Delete" onclick="openConfirm('${key}')">üóë</button>
          </div>
        </td>
      </tr>`;
    }).join('');

    updateSortHeaders();
  }

  function escHtml(str) {
    const d = document.createElement('div');
    d.textContent = str;
    return d.innerHTML;
  }

  // ‚îÄ‚îÄ‚îÄ Add/Edit Modal ‚îÄ‚îÄ‚îÄ
  function openAddModal() {
    editingKey = null;
    document.getElementById('modal-title').textContent = 'Add Sample';
    document.getElementById('save-btn').textContent = 'Save Sample';
    clearForm();
    document.getElementById('form-modal').classList.add('active');
  }

  function openEditModal(key) {
    editingKey = key;
    const s = allSamples[key];
    if (!s) return;

    document.getElementById('modal-title').textContent = 'Edit Sample';
    document.getElementById('save-btn').textContent = 'Update Sample';
    document.getElementById('f-name').value = s.name || '';
    document.getElementById('f-id').value = s.sampleId || '';
    document.getElementById('f-desc').value = s.description || '';
    document.getElementById('f-owner').value = s.owner || '';
    document.getElementById('f-date').value = s.date || '';
    document.getElementById('f-location').value = s.location || '';

    selectedFile = null;
    if (s.imageUrl) {
      document.getElementById('upload-preview').src = s.imageUrl;
      document.getElementById('upload-preview').style.display = 'block';
      document.getElementById('upload-placeholder').style.display = 'none';
      document.getElementById('upload-remove').style.display = 'flex';
      document.getElementById('upload-area').classList.add('has-image');
    } else {
      resetUploadArea();
    }

    document.getElementById('form-modal').classList.add('active');
  }

  function closeFormModal() {
    document.getElementById('form-modal').classList.remove('active');
    editingKey = null;
    selectedFile = null;
  }

  function clearForm() {
    document.getElementById('f-name').value = '';
    document.getElementById('f-id').value = '';
    document.getElementById('f-desc').value = '';
    document.getElementById('f-owner').value = '';
    document.getElementById('f-date').value = new Date().toISOString().split('T')[0];
    document.getElementById('f-location').value = '';
    selectedFile = null;
    resetUploadArea();
  }

  function resetUploadArea() {
    document.getElementById('upload-preview').style.display = 'none';
    document.getElementById('upload-placeholder').style.display = 'block';
    document.getElementById('upload-remove').style.display = 'none';
    document.getElementById('upload-area').classList.remove('has-image');
    document.getElementById('file-input').value = '';
  }

  // ‚îÄ‚îÄ‚îÄ File handling ‚îÄ‚îÄ‚îÄ
  function handleFileSelect(e) {
    const file = e.target.files[0];
    if (!file) return;

    if (file.size > 5 * 1024 * 1024) {
      showToast('Image must be under 5 MB', 'error');
      return;
    }

    if (!file.type.startsWith('image/')) {
      showToast('Please select an image file', 'error');
      return;
    }

    const reader = new FileReader();
    reader.onload = function(ev) {
      const img = new Image();
      img.onload = function() {
        const canvas = document.createElement('canvas');
        const MAX = 800;
        let w = img.width, h = img.height;
        if (w > MAX || h > MAX) {
          if (w > h) { h = Math.round(h * MAX / w); w = MAX; }
          else { w = Math.round(w * MAX / h); h = MAX; }
        }
        canvas.width = w;
        canvas.height = h;
        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
        const base64 = canvas.toDataURL('image/jpeg', 0.7);
        selectedFile = base64;

        document.getElementById('upload-preview').src = base64;
        document.getElementById('upload-preview').style.display = 'block';
        document.getElementById('upload-placeholder').style.display = 'none';
        document.getElementById('upload-remove').style.display = 'flex';
        document.getElementById('upload-area').classList.add('has-image');
      };
      img.src = ev.target.result;
    };
    reader.readAsDataURL(file);
  }

  function removeImage(e) {
    e.stopPropagation();
    selectedFile = null;
    resetUploadArea();
  }

  // ‚îÄ‚îÄ‚îÄ Save ‚îÄ‚îÄ‚îÄ
  async function saveSample() {
    const name = document.getElementById('f-name').value.trim();
    const sampleId = document.getElementById('f-id').value.trim();
    const description = document.getElementById('f-desc').value.trim();
    const owner = document.getElementById('f-owner').value.trim();
    const date = document.getElementById('f-date').value;
    const location = document.getElementById('f-location').value.trim();

    if (!name || !sampleId || !owner) {
      showToast('Please fill in all required fields', 'error');
      return;
    }

    const saveBtn = document.getElementById('save-btn');
    saveBtn.disabled = true;
    saveBtn.textContent = 'Saving...';

    try {
      let imageUrl = '';

      if (editingKey && !selectedFile && allSamples[editingKey]?.imageUrl) {
        const preview = document.getElementById('upload-preview');
        if (preview.style.display !== 'none') {
          imageUrl = allSamples[editingKey].imageUrl;
        }
      }

      if (selectedFile) {
        imageUrl = selectedFile;
      }

      const data = {
        name,
        sampleId,
        description,
        owner,
        date,
        location,
        imageUrl,
        updatedAt: Date.now()
      };

      if (editingKey) {
        data.createdAt = allSamples[editingKey]?.createdAt || Date.now();
        await samplesRef.child(editingKey).set(data);
        showToast('Sample updated ‚úì', 'success');
      } else {
        data.createdAt = Date.now();
        await samplesRef.push(data);
        showToast('Sample added ‚úì', 'success');
      }

      closeFormModal();
    } catch (err) {
      console.error('Save error:', err);
      showToast('Error saving sample: ' + err.message, 'error');
    } finally {
      saveBtn.disabled = false;
      saveBtn.textContent = editingKey ? 'Update Sample' : 'Save Sample';
    }
  }

  // ‚îÄ‚îÄ‚îÄ Delete ‚îÄ‚îÄ‚îÄ
  function openConfirm(key) {
    deleteKey = key;
    const s = allSamples[key];
    document.getElementById('confirm-name').textContent = s?.name || 'this sample';
    document.getElementById('confirm-modal').classList.add('active');
  }

  function closeConfirm() {
    document.getElementById('confirm-modal').classList.remove('active');
    deleteKey = null;
  }

  async function confirmDelete() {
    if (!deleteKey) return;
    try {
      await samplesRef.child(deleteKey).remove();
      showToast('Sample deleted', 'success');
    } catch (err) {
      showToast('Error deleting: ' + err.message, 'error');
    }
    closeConfirm();
  }

  // ‚îÄ‚îÄ‚îÄ Image Viewer ‚îÄ‚îÄ‚îÄ
  function openViewer(url) {
    event.stopPropagation();
    document.getElementById('viewer-img').src = url;
    document.getElementById('viewer').classList.add('active');
  }

  function closeViewer() {
    document.getElementById('viewer').classList.remove('active');
  }

  // ‚îÄ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ
  function showToast(msg, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = msg;
    toast.className = 'toast show ' + type;
    clearTimeout(toast._timeout);
    toast._timeout = setTimeout(() => { toast.classList.remove('show'); }, 3000);
  }

  // ‚îÄ‚îÄ‚îÄ Keyboard shortcuts ‚îÄ‚îÄ‚îÄ
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeFormModal();
      closeConfirm();
      closeViewer();
    }
  });
</script>

</body>
</html>
